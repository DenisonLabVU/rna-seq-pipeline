# Denison Lab Virus Recombination Analysis on Illumina poly-A RNA-seq data
Authored by Jennifer Gribble October 2020. Several scripts were generated by Andrew Routh (UTMB) and Jennifer Gribble (VUMC).

Data was generated as paired-end fastq files. Trimming from fastq.gz files to separate files by Trimmomatic 0.39. Reference index is built by bowtie-build and ViReMa is run as indicated in Gribble et al, 2020.

Generate junction plots (Junction_Pattern_Plots.R) using BED File (Recombination_Results.bed) as input

Use PRF_calculation.R. Input files are sample_forward_single.txt and coverage file.

DVG v. sgmRNA filtering (Input files is sample_forward_single.txt)
  sgmRNA_filtering_SARS2.R (windows are determined by Kim et al, Cell, 2020 and match NC_045512.2 and MT020881.1).
  Explanation of output files:
    “Canonical” sgmRNAs are the most abundant of a species
    “Alternative” sgmRNAs are all other less abundant species
    Sample_canonical_sgmRNAs.txt = tab-delineated file of the different canonical sgmRNA junction species with columns matching “Genome”, “Start”, “Stop”, and “Depth”
    Sample_alternative_sgmRNAs.txt = tab-delineated file of each distinct junction corresponding to a different alternative sgmRNA with columns matching “Genome”, “Start”, “Stop”, and “Depth”
    Sample_total_sgmRNAs.txt = tab-delineated file of all sgmRNA-forming junctions
    Sample_alt_sgmRNA_summary.txt = tab-delinated file of the type of sgmRNA species (sgmRNA2, sgmRNA3, etc) and the total depth for each population
    Sample_DVGs.bed.txt = BED-formatted file of junctions forming DVGs

% ACGU (input file = sample_DVGs.bed.txt) (UNWEIGHTED by depth)
sort -k4 -rn sample.bed.txt > sample_sort.bed.txt
python Rec_Site_Extraction.py --Window 40 sample_sort.bed.txt reference.fa sample_output.txt
%ACGT.R
  Make sure to the change the nrow variable in the matrix to match the number of nucleotides in your sequences. And the position labels of the output file. I always label so the +1 position is the junction forming in the resulting DVG sequence, ie Start sequences have +21 to -20 to account for junction-forming nucleotide being a part of the upstream sequence and Stop sequences have +20 to -21 to account for junction-forming nucleotide being a part of the downstream sequence.

uHomologyPlots.py (input is sample_Virus_Recombination_Results.txt) (run in IDE)

Shannon_Entropy.py (input is sampe_Virus_Recombiantion_Results.txt)
  Usage:
  python2 Shannon_Entropy.py sample_Recombination_Results.txt mean_viral_depth virus_accession
  If desired, remove library headers to make single list of data to get single Shannon entropy index. Use average depth across virus in input as “considering WT.”
